<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="manifest.json">
<title>CHUGGED TO DEATH</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: #0a0a0a;
  font-family: monospace;
}

#game-container {
  position: relative;
  width: 100vw;
  height: 100vh;
}

canvas {
  display: block;
  background: #111;
}

.controls {
  position: absolute;
  bottom: calc(30px + env(safe-area-inset-bottom));
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 40px;
  pointer-events: none;
  z-index: 10;
}

.btn-group {
  display: flex;
  gap: 20px;
  pointer-events: auto;
}

.btn {
  width: 80px;
  height: 80px;
  background: rgba(139,0,0,0.3);
  border: 3px solid rgba(192,192,192,0.5);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  color: white;
  user-select: none;
}

.btn:active {
  background: #8b0000;
  transform: scale(0.9);
}
</style>
</head>

<body>
<div id="game-container">
  <canvas id="gameCanvas"></canvas>

  <div class="controls">
    <div class="btn-group">
      <div id="btn-left" class="btn">‚Üê</div>
      <div id="btn-right" class="btn">‚Üí</div>
    </div>
    <div class="btn-group">
      <div id="btn-jump" class="btn">J</div>
      <div id="btn-shoot" class="btn">ü§ò</div>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

/* ---------- SPRITES ---------- */
const SPRITES = {
  idle: {
    fps: 4,
    frames: ["IMG_5163.jpeg"]
  },
  shoot: {
    fps: 8,
    frames: ["IMG_5164.jpeg", "IMG_5165.jpeg"]
  }
};

class SpriteManager {
  constructor(defs) {
    this.defs = defs;
    this.images = {};
  }

  load() {
    Object.entries(this.defs).forEach(([state, def]) => {
      this.images[state] = [];
      def.frames.forEach(src => {
        const img = new Image();
        img.onload = () => img._ready = true;
        img.src = src;
        this.images[state].push(img);
      });
    });
  }

  getFrame(state, time) {
    const def = this.defs[state];
    const frames = this.images[state];
    if (!def || !frames) return null;

    const i =
      Math.floor(time / (1000 / def.fps)) % frames.length;

    return frames[i]?._ready ? frames[i] : null;
  }
}

const spriteManager = new SpriteManager(SPRITES);
spriteManager.load();

/* ---------- GAME ---------- */
const GRAVITY = 0.6;
const SHRED_SPEED = 10;
let width, height, floorY;

const player = {
  x: 100, y: 0, w: 60, h: 80,
  vx: 0, vy: 0,
  grounded: false,
  direction: 1,
  state: "idle"
};

const keys = { left:false, right:false, jump:false, shoot:false };
const notes = [];
const enemies = [];
let lastShot = 0;

function resize() {
  width = innerWidth;
  height = innerHeight;
  canvas.width = width;
  canvas.height = height;
  floorY = height - 160;
  player.y = floorY - player.h;
}

function bind(id, key) {
  const el = document.getElementById(id);
  el.addEventListener("touchstart", e => {
    e.preventDefault(); keys[key] = true;
  });
  el.addEventListener("touchend", e => {
    e.preventDefault(); keys[key] = false;
  });
}

bind("btn-left","left");
bind("btn-right","right");
bind("btn-jump","jump");
bind("btn-shoot","shoot");

function update() {
  if (keys.shoot) player.state = "shoot";
  else if (!player.grounded) player.state = "jump";
  else if (keys.left || keys.right) player.state = "walk";
  else player.state = "idle";

  if (keys.left) { player.vx = -5; player.direction = -1; }
  else if (keys.right) { player.vx = 5; player.direction = 1; }
  else player.vx *= 0.8;

  if (keys.jump && player.grounded) {
    player.vy = -14;
    player.grounded = false;
  }

  if (keys.shoot && Date.now() - lastShot > 200) {
    notes.push({
      x: player.x + (player.direction === 1 ? player.w : 0),
      y: player.y + 35,
      vx: player.direction * SHRED_SPEED,
      symbol: "‚ô´"
    });
    lastShot = Date.now();
  }

  player.x += player.vx;
  player.y += player.vy;
  player.vy += GRAVITY;

  if (player.y > floorY - player.h) {
    player.y = floorY - player.h;
    player.vy = 0;
    player.grounded = true;
  }

  // enemies
  if (Math.random() < 0.02) {
    enemies.push({ x: width+50, y: floorY-50, w:40, h:50, speed:2 });
  }

  enemies.forEach((e,i) => {
    e.x -= e.speed;
    notes.forEach((n,ni) => {
      if (n.x < e.x+e.w && n.x+10 > e.x && n.y < e.y+e.h && n.y+10 > e.y) {
        enemies.splice(i,1);
        notes.splice(ni,1);
      }
    });
  });
}

function draw() {
  ctx.clearRect(0,0,width,height);

  ctx.fillStyle="#1a1a1a";
  ctx.fillRect(0,floorY,width,height-floorY);

  ctx.save();
  ctx.translate(player.x+player.w/2, player.y+player.h/2);
  ctx.scale(player.direction,1);

  const sprite =
    spriteManager.getFrame(player.state, performance.now()) ||
    spriteManager.getFrame("idle", performance.now());

  if (sprite) {
    ctx.drawImage(sprite, -player.w/2, -player.h/2, player.w, player.h);
  } else {
    ctx.fillStyle="#fff";
    ctx.fillRect(-player.w/2,-player.h/2,player.w,player.h);
  }

  ctx.restore();

  ctx.fillStyle="#444";
  enemies.forEach(e => ctx.fillRect(e.x,e.y,e.w,e.h));

  ctx.fillStyle="#0ff";
  ctx.font="24px Arial";
  notes.forEach(n => ctx.fillText(n.symbol,n.x,n.y));
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

addEventListener("resize",resize);
resize();
loop();
</script>
</body>
</html>